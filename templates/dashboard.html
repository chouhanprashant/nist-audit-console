<!DOCTYPE html>
<html>
<head>
    <title>NIST Audit Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container">
            <span class="navbar-brand">NIST Audit Console</span>
        </div>
    </nav>
    
    <div class="container mt-4">
        <h2>Security Compliance Dashboard</h2>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Download Agent</h5>
                        <p>Run audit on Windows Server</p>
                        <a href="/download/windows-agent" class="btn btn-primary">Download</a>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Upload Report</h5>
                        <input type="file" id="reportFile" class="form-control">
                        <button onclick="uploadReport()" class="btn btn-success mt-2">Upload</button>
                        <div id="uploadStatus" class="mt-2"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <canvas id="scoreChart"></canvas>
            </div>
            <div class="col-md-6">
                <table class="table" id="reportsTable">
                    <thead>
                        <tr><th>Server</th><th>Score</th><th>Time</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        async function loadDashboard() {
            // Load stats
            const stats = await fetch('/api/stats').then(r => r.json());
            document.getElementById('serversCount').innerText = stats.servers_count;
            
            // Load reports
            const reports = await fetch('/api/reports').then(r => r.json());
            updateTable(reports.reports);
            
            // Update chart
            updateChart(reports.reports);
        }
        
        async function uploadReport() {
            const fileInput = document.getElementById('reportFile');
            const formData = new FormData();
            formData.append('report', fileInput.files[0]);
            
            const response = await fetch('/api/upload', {
                method: 'POST',
                body: formData
            });
            
            const result = await response.json();
            if (result.success) {
                document.getElementById('uploadStatus').innerHTML = 
                    `<div class="alert alert-success">Uploaded! Score: ${result.score}%</div>`;
                loadDashboard();
            }
        }
        
        function updateTable(reports) {
            const tbody = document.querySelector('#reportsTable tbody');
            tbody.innerHTML = '';
            reports.forEach(report => {
                tbody.innerHTML += `
                    <tr>
                        <td>${report.server}</td>
                        <td>${report.score}%</td>
                        <td>${new Date(report.timestamp).toLocaleString()}</td>
                    </tr>
                `;
            });
        }
        
        function updateChart(reports) {
            // Chart implementation
            const ctx = document.getElementById('scoreChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: reports.map(r => r.server),
                    datasets: [{
                        label: 'NIST Score',
                        data: reports.map(r => r.score),
                        backgroundColor: 'rgba(54, 162, 235, 0.5)'
                    }]
                }
            });
        }
        
        // Load on start
        loadDashboard();
    </script>
</body>
</html>
